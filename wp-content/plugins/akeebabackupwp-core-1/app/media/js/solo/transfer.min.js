if(typeof Solo=="undefined"){var Solo={}}if(typeof Solo.Transfer=="undefined"){Solo.Transfer={lastUrl:"",lastResult:"",FtpBrowser:{params:{}},SftpBrowser:{params:{}},FtpTest:{},SftpTest:{},URLs:{},translations:{}}}(function(a){Solo.Transfer.onUrlChange=function(d){if(d==undefined){d=false}var c=a("#akeeba-transfer-url");var b=c.val();if(b==""){a("#akeeba-transfer-lbl-url").show()}if((b.substring(0,7)!="http://")&&(b.substring(0,8)!="https://")){b="http://"+b}if(!d&&(b==Solo.Transfer.lastUrl)){Solo.Transfer.applyUrlCheck({status:Solo.Transfer.lastResult,url:Solo.Transfer.lastUrl});return}a("#akeeba-transfer-row-url > div").each(function(e,f){a(f).hide()});c.attr("disabled","disabled");a("#akeeba-transfer-btn-url").attr("disabled","disabled");a("#akeeba-transfer-loading").show();Solo.System.doAjax({task:"checkUrl",url:b},Solo.Transfer.applyUrlCheck,function(e){c.removeAttr("disabled");a("#akeeba-transfer-btn-url").removeAttr("disabled");a("#akeeba-transfer-loading").hide()},false,10000)};Solo.Transfer.applyUrlCheck=function(b){var c=a("#akeeba-transfer-url");c.removeAttr("disabled");a("#akeeba-transfer-btn-url").removeAttr("disabled");a("#akeeba-transfer-loading").hide();a("#akeeba-transfer-ftp-container").hide();c.val(b.url);Solo.Transfer.lastResult=b.status;Solo.Transfer.lastUrl=b.url;switch(b.status){case"ok":Solo.Transfer.showConnectionDetails();break;case"same":a("#akeeba-transfer-err-url-same").show();break;case"invalid":a("#akeeba-transfer-err-url-invalid").show();break;case"notexists":a("#akeeba-transfer-err-url-notexists").show();break}};Solo.Transfer.showConnectionDetails=function(){a("#akeeba-transfer-url").attr("disabled","disabled");a("#akeeba-transfer-btn-url").attr("disabled","disabled");a("#akeeba-transfer-err-url-notexists").hide();a("#akeeba-transfer-ftp-container").show();Solo.Transfer.onTransferMethodChange();return false};Solo.Transfer.onTransferMethodChange=function(b){var c=a("#akeeba-transfer-ftp-method").val();a("#akeeba-transfer-ftp-host").parent().parent().hide();a("#akeeba-transfer-ftp-port").parent().parent().hide();a("#akeeba-transfer-ftp-username").parent().parent().hide();a("#akeeba-transfer-ftp-password").parent().parent().hide();a("#akeeba-transfer-ftp-pubkey").parent().parent().hide();a("#akeeba-transfer-ftp-privatekey").parent().parent().hide();a("#akeeba-transfer-ftp-directory").parent().parent().parent().hide();a("#akeeba-transfer-ftp-passive-container").hide();a("#akeeba-transfer-apply-loading").hide();if(c!="manual"){a("#akeeba-transfer-ftp-host").parent().parent().show();a("#akeeba-transfer-ftp-port").parent().parent().show();a("#akeeba-transfer-ftp-username").parent().parent().show();a("#akeeba-transfer-ftp-password").parent().parent().show();a("#akeeba-transfer-ftp-directory").parent().parent().parent().show()}if((c=="ftp")||(c=="ftps")){a("#akeeba-transfer-ftp-passive-container").show()}if(c=="sftp"){a("#akeeba-transfer-ftp-pubkey").parent().parent().show();a("#akeeba-transfer-ftp-privatekey").parent().parent().show()}};Solo.Transfer.FtpBrowser.initialise=function(){Solo.Transfer.FtpBrowser.params.host=a("#akeeba-transfer-ftp-host").val();Solo.Transfer.FtpBrowser.params.port=a("#akeeba-transfer-ftp-port").val();Solo.Transfer.FtpBrowser.params.username=a("#akeeba-transfer-ftp-username").val();Solo.Transfer.FtpBrowser.params.password=a("#akeeba-transfer-ftp-password").val();Solo.Transfer.FtpBrowser.params.passive=a("#akeeba-transfer-ftp-passive1").is(":checked")?1:0;Solo.Transfer.FtpBrowser.params.ssl=(a("akeeba-transfer-ftp-method").val()=="ftps")?1:0;Solo.Transfer.FtpBrowser.params.directory=a("#akeeba-transfer-ftp-directory").val();Solo.Transfer.FtpBrowser.open()};Solo.Transfer.FtpBrowser.open=function(){var b=a("#ftpdialog");b.css("display","block");b.removeClass("ui-state-error");a("#ftpdialogOkButton").click(function(d){Solo.Transfer.FtpBrowser.callback(Solo.Transfer.FtpBrowser.params.directory);a("#ftpdialog").modal("hide")});b.modal("show");a("#ftpBrowserErrorContainer").css("display","none");a("#ftpBrowserFolderList").html("");a("#ftpBrowserCrumbs").html("");if(empty(Solo.Transfer.FtpBrowser.params.directory)){Solo.Transfer.FtpBrowser.params.directory=""}var c={view:"ftpbrowser",task:"browse",host:Solo.Transfer.FtpBrowser.params.host,port:Solo.Transfer.FtpBrowser.params.port,username:Solo.Transfer.FtpBrowser.params.username,password:Solo.Transfer.FtpBrowser.params.password,passive:(Solo.Transfer.FtpBrowser.params.passive?1:0),ssl:(Solo.Transfer.FtpBrowser.params.ssl?1:0),directory:Solo.Transfer.FtpBrowser.params.directory};Solo.System.doAjax(c,function(f){var d=a("#ak_crumbs2");if(f.error!=false){a("#ftpBrowserError").html(f.error);a("#ftpBrowserErrorContainer").css("display","block");a("#ftpBrowserFolderList").css("display","none");a("#ftpBrowserWrapper").css("display","none");d.css("display","none")}else{a("#ftpBrowserErrorContainer").css("display","none");a("#ftpBrowserWrapper").css("display","block");if(!empty(f.breadcrumbs)){d.css("display","block");d.html("");var e="/";Solo.Transfer.FtpBrowser.addCrumb(Solo.Transfer.translations["UI-ROOT"],"/",d);a.each(f.breadcrumbs,function(h,g){e+="/"+g;Solo.Transfer.FtpBrowser.addCrumb(g,e,a("#ak_crumbs2"))})}else{a("#ftpBrowserCrumbs").css("display","none")}if(!empty(f.list)){a("#ftpBrowserFolderList").css("display","block");a.each(f.list,function(g,h){Solo.Transfer.FtpBrowser.createLink(f.directory+"/"+h,h,a("#ftpBrowserFolderList"))})}else{a("#ftpBrowserFolderList").css("display","none")}}},function(d){a("#ftpBrowserError").html(d);a("#ftpBrowserErrorContainer").css("display","block");a("#ftpBrowserFolderList").css("display","none");a("#ftpBrowserCrumbs").css("display","none");a("#ftpBrowserWrapper").css("display","none")},false)};Solo.Transfer.FtpBrowser.createLink=function(g,e,c,f){if(typeof f=="undefined"){f=Solo.Transfer.FtpBrowser}var h=a(document.createElement("tr"));var b=a(document.createElement("td")).appendTo(h);var d=a(document.createElement("a")).text(e).click(function(){f.params.directory=g;f.open()}).appendTo(b);h.appendTo(a(c))};Solo.Transfer.FtpBrowser.addCrumb=function(e,d,c,f){if(typeof f=="undefined"){f=Solo.Transfer.FtpBrowser}var b=a(document.createElement("li"));a(document.createElement("a")).html(e).click(function(g){f.params.directory=d;f.open();g.preventDefault()}).appendTo(b);a(document.createElement("span")).addClass("divider").html("/").appendTo(b);b.appendTo(c)};Solo.Transfer.SftpBrowser.initialise=function(){Solo.Transfer.SftpBrowser.params.host=a("#akeeba-transfer-ftp-host").val();Solo.Transfer.SftpBrowser.params.port=a("#akeeba-transfer-ftp-port").val();Solo.Transfer.SftpBrowser.params.username=a("#akeeba-transfer-ftp-username").val();Solo.Transfer.SftpBrowser.params.password=a("#akeeba-transfer-ftp-password").val();Solo.Transfer.SftpBrowser.params.directory=a("#akeeba-transfer-ftp-directory").val();Solo.Transfer.SftpBrowser.params.privKey=a("#akeeba-transfer-ftp-privatekey").val();Solo.Transfer.SftpBrowser.params.pubKey=a("#akeeba-transfer-ftp-pubkey").val();Solo.Transfer.SftpBrowser.open()};Solo.Transfer.SftpBrowser.open=function(){var b=a("#sftpdialog");b.css("display","block");b.removeClass("ui-state-error");a("#sftpdialogOkButton").click(function(d){Solo.Transfer.FtpBrowser.callback(Solo.Transfer.SftpBrowser.params.directory);a("#sftpdialog").modal("hide")});b.modal("show");a("#sftpBrowserErrorContainer").css("display","none");a("#sftpBrowserFolderList").html("");a("#sftpBrowserCrumbs").html("");var c={view:"sftpbrowser",task:"browse",host:Solo.Transfer.SftpBrowser.params.host,port:Solo.Transfer.SftpBrowser.params.port,username:Solo.Transfer.SftpBrowser.params.username,password:Solo.Transfer.SftpBrowser.params.password,directory:Solo.Transfer.SftpBrowser.params.directory,privkey:Solo.Transfer.SftpBrowser.params.privKey,pubkey:Solo.Transfer.SftpBrowser.params.pubKey};Solo.System.doAjax(c,function(f){var e=a("#ak_scrumbs");if(f.error!=false){a("#sftpBrowserError").html(f.error);a("#sftpBrowserErrorContainer").css("display","block");a("#sftpBrowserFolderList").css("display","none");a("#sftpBrowserWrapper").css("display","none");e.css("display","none")}else{a("#ftpBrowserErrorContainer").css("display","none");a("#sftpBrowserWrapper").css("display","block");if(!empty(f.breadcrumbs)){e.css("display","block");e.html("");var d="/";Solo.Transfer.FtpBrowser.addCrumb(Solo.Transfer.translations["UI-ROOT"],"/",e,Solo.Transfer.SftpBrowser);a.each(f.breadcrumbs,function(h,g){d+="/"+g;Solo.Transfer.FtpBrowser.addCrumb(g,d,a("#ak_scrumbs"),Solo.Transfer.SftpBrowser)})}else{a("#sftpBrowserCrumbs").css("display","none")}if(!empty(f.list)){a("#sftpBrowserFolderList").css("display","block");a.each(f.list,function(g,h){Solo.Transfer.FtpBrowser.createLink(f.directory+"/"+h,h,a("#sftpBrowserFolderList"),Solo.Transfer.SftpBrowser)})}else{a("#sftpBrowserFolderList").css("display","none")}}},function(d){a("#sftpBrowserError").html(d);a("#sftpBrowserErrorContainer").css("display","block");a("#sftpBrowserFolderList").css("display","none");a("#sftpBrowserCrumbs").css("display","none");a("#sftpBrowserWrapper").css("display","none")},false)};Solo.Transfer.applyConnection=function(){a("#akeeba-transfer-ftp-error").hide();a("#akeeba-transfer-apply-loading").show();var b=a("#akeeba-transfer-btn-apply");b.attr("disabled","disabled");a("#akeeba-transfer-ftp-method").attr("disabled","disabled");a("#akeeba-transfer-ftp-host").parent().parent().hide();a("#akeeba-transfer-ftp-port").parent().parent().hide();a("#akeeba-transfer-ftp-username").parent().parent().hide();a("#akeeba-transfer-ftp-password").parent().parent().hide();a("#akeeba-transfer-ftp-pubkey").parent().parent().hide();a("#akeeba-transfer-ftp-privatekey").parent().parent().hide();a("#akeeba-transfer-ftp-directory").parent().parent().parent().hide();a("#akeeba-transfer-ftp-passive-container").hide();var d=a("#akeeba-transfer-ftp-method").val();if(d=="manual"){a("#akeeba-transfer-btn-apply").parent().hide();a("#akeeba-transfer-manualtransfer").show();return}var c={task:"applyConnection",method:d,host:a("#akeeba-transfer-ftp-host").val(),port:a("#akeeba-transfer-ftp-port").val(),username:a("#akeeba-transfer-ftp-username").val(),password:a("#akeeba-transfer-ftp-password").val(),directory:a("#akeeba-transfer-ftp-directory").val(),passive:a("#akeeba-transfer-ftp-passive1").is(":checked")?1:0,priKey:a("#akeeba-transfer-ftp-privatekey").val(),pubKey:a("#akeeba-transfer-ftp-pubkey").val()};Solo.System.doAjax(c,function(e){a("#akeeba-transfer-apply-loading").hide();if(!e.status){a("#akeeba-transfer-btn-apply").removeAttr("disabled");a("#akeeba-transfer-ftp-method").removeAttr("disabled");a("#akeeba-transfer-ftp-error").html(e.message);a("#akeeba-transfer-ftp-error").show();a("#akeeba-transfer-ftp-error").focus();Solo.Transfer.onTransferMethodChange();return}Solo.Transfer.uploadKickstart()},function(){a("#akeeba-transfer-btn-apply").removeAttr("disabled");a("#akeeba-transfer-ftp-method").removeAttr("disabled");a("#akeeba-transfer-ftp-error").html(Solo.Transfer.translations["UI-TESTFTP-FAIL"]).show().focus();Solo.Transfer.onTransferMethodChange()},false,15000)};Solo.Transfer.uploadKickstart=function(){var b=a("#akeeba-transfer-upload-lbl-kickstart");var c=a("#akeeba-transfer-upload-lbl-archive");var e=a("#akeeba-transfer-upload-error");e.hide();b.removeClass("label-default").removeClass("label-success").removeClass("label-important").addClass("label-warning");c.addClass("label-default").removeClass("label-success").removeClass("label-important").removeClass("label-warning");a("#akeeba-transfer-upload-area-kickstart").hide();a("#akeeba-transfer-upload-area-upload").show();a("#akeeba-transfer-upload").show();var d={task:"initialiseUpload"};Solo.System.doAjax(d,function(f){if(!f.status){b.addClass("label-important").removeClass("label-warning");e.html(f.message);e.show();return}Solo.Transfer.uploadArchive(1)},null,false,150000)};Solo.Transfer.uploadArchive=function(f){if(f==undefined){f=0}var b=a("#akeeba-transfer-upload-lbl-kickstart");var c=a("#akeeba-transfer-upload-lbl-archive");var e=a("#akeeba-transfer-upload-error");e.hide();b.removeClass("label-default").addClass("label-success").removeClass("label-important").removeClass("label-warning");c.removeClass("label-default").removeClass("label-success").removeClass("label-important").addClass("label-warning");var d={task:"upload",start:f};Solo.System.doAjax(d,function(i){if(!i.result){c.addClass("label-important").removeClass("label-warning");e.html(i.message);e.show();return}if(i.done){a("#akeeba-transfer-upload-percent").html("100 %");a("#akeeba-transfer-upload-size").html("");var k=a("#akeeba-transfer-url");var h=k.val().replace(/\/$/,"")+"/kickstart.php";a("#akeeba-transfer-upload-area-kickstart").show();a("#akeeba-transfer-upload-area-upload").hide();a("#akeeba-transfer-upload-btn-kickstart").attr("href",h);return}var l=0;var g=i.totalSize*1;var j=i.doneSize*1;if((g>0)&&(j>0)){l=100*(j/g)}a("#akeeba-transfer-upload-percent").html(l.toFixed(2)+"%");a("#akeeba-transfer-upload-size").html(j.toFixed(0)+" / "+g.toFixed(0)+" bytes");window.setTimeout(function(){Solo.Transfer.uploadArchive(0)},50)},null,false,150000)};Solo.Transfer.initFtpSftpBrowser=function(){var b=a("#akeeba-transfer-ftp-method").val();if((b=="ftp")||(b=="ftps")){Solo.Transfer.FtpBrowser.initialise()}else{if(b=="sftp"){Solo.Transfer.SftpBrowser.initialise()}}return false};Solo.Transfer.testFtpSftpConnection=function(){var b=a("#akeeba-transfer-ftp-method").val();if((b=="ftp")||(b=="ftps")){Solo.Transfer.FtpTest.testConnection("akeeba-transfer-btn-testftp")}else{if(b=="sftp"){Solo.Transfer.SftpTest.testConnection("akeeba-transfer-btn-testftp")}}return false};Solo.Transfer.FtpBrowser.callback=function(b){if(b.substring(0,2)=="//"){b=b.substring(1)}a("#akeeba-transfer-ftp-directory").val(b)};a(document).ready(function(){a("#akeeba-transfer-ftp-method").change(Solo.Transfer.onTransferMethodChange)})}(akeeba.jQuery));